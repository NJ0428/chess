<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>통계 - NAK 체스 게임</title>
  <meta name="description" content="개인 체스 통계와 성과를 확인하세요. 레이팅, 승률, 게임 히스토리 등 상세한 분석을 제공합니다.">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="main.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Skip to Content -->
  <a href="#main-content" class="skip-to-content">메인 컨텐츠로 이동</a>

  <header id="header" class="header" role="banner">
    <div class="container">
      <div class="logo">
        <h1><a href="index.html" style="text-decoration: none; color: inherit;"><i class="fas fa-chess-king" aria-hidden="true"></i> NAK 체스</a></h1>
      </div>
      <nav class="nav" role="navigation" aria-label="메인 네비게이션">
        <ul class="nav-list" id="nav-list">
          <li><a href="index.html" class="nav-link">홈</a></li>
          <li><a href="features.html" class="nav-link">기능</a></li>
          <li><a href="how-to-play.html" class="nav-link">게임 방법</a></li>
          <li><a href="chess-rules.html" class="nav-link">체스 규칙</a></li>
          <li><a href="leaderboard.html" class="nav-link">리더보드</a></li>
          <li><a href="stats.html" class="nav-link active">통계</a></li>
        </ul>
      </nav>
      <div class="header-actions">
        <!-- Dark Mode Toggle -->
        <button id="dark-mode-toggle" class="icon-btn" aria-label="다크모드 전환" title="다크모드 전환">
          <i class="fas fa-moon"></i>
        </button>

        <!-- Auth Links / Profile -->
        <div id="auth-links" class="auth-links">
          <a href="login.html" class="btn btn-sm btn-outline">로그인</a>
          <a href="game.html" class="btn btn-sm btn-primary">게임 시작</a>
        </div>
      </div>
      <div class="mobile-nav-toggle" id="mobile-nav-toggle" aria-label="모바일 메뉴 토글">
        <i class="fas fa-bars"></i>
      </div>
    </div>
  </header>

  <main id="main-content">
    <!-- Page Hero -->
    <section class="page-hero">
      <div class="container">
        <div class="page-hero-content reveal">
          <h1><i class="fas fa-chart-line"></i> 통계 대시보드</h1>
          <p>개인 게임 통계를 분석하고 실력을 향상시켜보세요</p>
        </div>
      </div>
    </section>

    <!-- Stats Page -->
    <section class="stats-page">
      <div class="container">
      
      <!-- 개인 통계 대시보드 -->
      <div class="section-header reveal">
        <h2><i class="fas fa-chart-line"></i> 개인 통계 대시보드</h2>
        <p>당신의 체스 게임 통계와 성과를 확인하세요</p>
      </div>

      <div class="dashboard-grid">
        <!-- 기본 통계 카드들 -->
        <div class="stats-card rating-card reveal" data-delay="0">
          <div class="card-header">
            <h3><i class="fas fa-trophy"></i> 현재 레이팅</h3>
          </div>
            <div class="card-content">
              <div class="rating-display">
                <div id="currentRating" class="rating-number">1200</div>
                <div id="ratingTier" class="rating-tier">Novice</div>
              </div>
              <div class="rating-change">
                <span id="ratingChange" class="rating-change-value">+0</span>
                <span class="rating-change-label">최근 게임</span>
              </div>
            </div>
          </div>

          <div class="stats-card games-card reveal" data-delay="100">
            <div class="card-header">
              <h3><i class="fas fa-chess-board"></i> 게임 통계</h3>
            </div>
            <div class="card-content">
              <div class="stats-grid">
                <div class="stat-item">
                  <div id="totalGames" class="stat-number">0</div>
                  <div class="stat-label">총 게임</div>
                </div>
                <div class="stat-item">
                  <div id="winRate" class="stat-number">0%</div>
                  <div class="stat-label">승률</div>
                </div>
                <div class="stat-item">
                  <div id="currentStreak" class="stat-number">0</div>
                  <div class="stat-label">연속 기록</div>
                </div>
              </div>
            </div>
          </div>

          <div class="stats-card record-card reveal" data-delay="200">
            <div class="card-header">
              <h3><i class="fas fa-medal"></i> 승부 기록</h3>
            </div>
            <div class="card-content">
              <div class="record-chart-container">
                <canvas id="recordChart"></canvas>
              </div>
              <div class="record-details">
                <div class="record-item wins">
                  <span id="totalWins" class="record-number">0</span>
                  <span class="record-label">승</span>
                </div>
                <div class="record-item draws">
                  <span id="totalDraws" class="record-number">0</span>
                  <span class="record-label">무</span>
                </div>
                <div class="record-item losses">
                  <span id="totalLosses" class="record-number">0</span>
                  <span class="record-label">패</span>
                </div>
              </div>
            </div>
          </div>

          <div class="stats-card achievements-card reveal" data-delay="300">
            <div class="card-header">
              <h3><i class="fas fa-award"></i> 업적</h3>
            </div>
            <div class="card-content">
              <div id="achievementsList" class="achievements-list">
                <div class="no-achievements">
                  <i class="fas fa-star"></i>
                  <p>아직 획득한 업적이 없습니다.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- 레이팅 히스토리 차트 -->
          <div class="stats-card chart-card reveal" data-delay="0">
            <div class="card-header">
              <h3><i class="fas fa-chart-area"></i> 레이팅 변화</h3>
            </div>
            <div class="card-content">
              <canvas id="ratingChart"></canvas>
            </div>
          </div>

          <!-- 상세 통계 -->
          <div class="stats-card details-card reveal" data-delay="100">
            <div class="card-header">
              <h3><i class="fas fa-info-circle"></i> 상세 통계</h3>
            </div>
            <div class="card-content">
              <div class="details-grid">
                <div class="detail-item">
                  <span class="detail-label">최고 레이팅</span>
                  <span id="highestRating" class="detail-value">1200</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">최저 레이팅</span>
                  <span id="lowestRating" class="detail-value">1200</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">최장 연승</span>
                  <span id="longestWinStreak" class="detail-value">0</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">최장 연패</span>
                  <span id="longestLoseStreak" class="detail-value">0</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">총 플레이 시간</span>
                  <span id="totalPlaytime" class="detail-value">0분</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">마지막 게임</span>
                  <span id="lastGameDate" class="detail-value">-</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 게임 히스토리 -->
      <section id="history" class="stats-section history-section">
        <div class="section-header reveal">
          <h2><i class="fas fa-history"></i> 게임 히스토리</h2>
          <p>최근 플레이한 게임들의 상세 기록</p>
        </div>
        
        <div class="history-controls">
          <button id="loadMoreHistory" class="btn btn-outline">
            <i class="fas fa-plus"></i> 더 보기
          </button>
        </div>

        <div class="history-container">
          <div id="gameHistoryList" class="history-list">
            <div class="loading-message">
              <i class="fas fa-spinner fa-spin"></i>
              <p>게임 히스토리를 불러오는 중...</p>
            </div>
          </div>
        </div>
      </section>

      <!-- 리더보드 -->
      <section id="leaderboard" class="stats-section leaderboard-section" style="display: none;">
        <div class="section-header">
          <h2><i class="fas fa-crown"></i> 리더보드</h2>
          <p>최고의 플레이어들과 순위를 확인하세요</p>
        </div>
        
        <div class="leaderboard-container">
          <div id="leaderboardList" class="leaderboard-list">
            <div class="loading-message">
              <i class="fas fa-spinner fa-spin"></i>
              <p>리더보드를 불러오는 중...</p>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- 알림 -->
  <div id="notification" class="notification"></div>

  <!-- 업적 모달 -->
  <div id="achievementModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div class="achievement-modal-content">
        <i class="fas fa-trophy achievement-icon"></i>
        <h3>새로운 업적 달성!</h3>
        <div id="newAchievements" class="new-achievements"></div>
      </div>
    </div>
  </div>

  <!-- 게임 히스토리 아이템 템플릿 -->
  <template id="historyItemTemplate">
    <div class="history-item">
      <div class="history-header">
        <div class="game-result">
          <span class="result-badge"></span>
        </div>
        <div class="game-info">
          <span class="opponent-name"></span>
          <span class="game-date"></span>
        </div>
        <div class="rating-change">
          <span class="rating-change-value"></span>
        </div>
      </div>
      <div class="history-details">
        <div class="detail-item">
          <span class="detail-label">색상:</span>
          <span class="player-color"></span>
        </div>
        <div class="detail-item">
          <span class="detail-label">이동 수:</span>
          <span class="move-count"></span>
        </div>
        <div class="detail-item">
          <span class="detail-label">게임 시간:</span>
          <span class="game-duration"></span>
        </div>
        <div class="detail-item">
          <span class="detail-label">결과:</span>
          <span class="result-type"></span>
        </div>
      </div>
    </div>
  </template>

  <!-- 리더보드 아이템 템플릿 -->
  <template id="leaderboardItemTemplate">
    <div class="leaderboard-item">
      <div class="rank-badge">
        <span class="rank-number"></span>
      </div>
      <div class="player-info">
        <div class="player-name"></div>
        <div class="player-tier"></div>
      </div>
      <div class="player-stats">
        <div class="stat-item">
          <span class="stat-value rating"></span>
          <span class="stat-label">레이팅</span>
        </div>
        <div class="stat-item">
          <span class="stat-value games"></span>
          <span class="stat-label">게임</span>
        </div>
        <div class="stat-item">
          <span class="stat-value winrate"></span>
          <span class="stat-label">승률</span>
        </div>
      </div>
    </div>
  </template>

  <footer class="footer" role="contentinfo">
    <div class="container">
      <div class="footer-content">
        <div class="footer-text">
          <p>&copy; <span id="current-year"></span> NAK 체스. All Rights Reserved.</p>
          <p class="version">Version 1.0.0</p>
        </div>
        <div class="footer-social">
          <a href="https://github.com/nakchess" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
            <i class="fab fa-github" aria-hidden="true"></i>
          </a>
          <a href="https://linkedin.com/company/nakchess" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
            <i class="fab fa-linkedin" aria-hidden="true"></i>
          </a>
          <a href="https://twitter.com/nakchess" target="_blank" rel="noopener noreferrer" aria-label="Twitter">
            <i class="fab fa-twitter" aria-hidden="true"></i>
          </a>
          <a href="https://discord.gg/nakchess" target="_blank" rel="noopener noreferrer" aria-label="Discord">
            <i class="fab fa-discord" aria-hidden="true"></i>
          </a>
        </div>
      </div>
    </div>
  </footer>

  <script src="main.js"></script>
  <script src="js/stats.js"></script>
  <script>
    // Set current year
    const currentYear = new Date().getFullYear();
    const yearElements = document.querySelectorAll('#current-year');
    yearElements.forEach(el => {
      if (el) el.textContent = currentYear;
    });

    // Enhanced Reveal on scroll animation
    const revealElements = document.querySelectorAll('.reveal');
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const delay = entry.target.dataset.delay || 0;

          setTimeout(() => {
            entry.target.classList.add('visible');

            // Add stagger effect for nested elements
            const nestedElements = entry.target.querySelectorAll(
              '.stat-item, .detail-item, .record-item'
            );
            nestedElements.forEach((el, index) => {
              setTimeout(() => {
                el.style.opacity = '1';
                el.style.transform = 'translateY(0)';
              }, index * 50);
            });

            // Animate numbers
            animateNumbers(entry.target);
          }, parseInt(delay));
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });

    // Initialize nested elements with hidden state
    document.querySelectorAll(
      '.stat-item, .detail-item, .record-item'
    ).forEach(el => {
      el.style.opacity = '0';
      el.style.transform = 'translateY(20px)';
      el.style.transition = 'all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)';
    });

    revealElements.forEach(el => observer.observe(el));

    // Animate numbers function
    function animateNumbers(container) {
      const numbers = container.querySelectorAll('.stat-number, .record-number, .rating-number');
      numbers.forEach(number => {
        const finalValue = parseInt(number.textContent) || 0;
        const duration = 2000;
        const startTime = performance.now();
        const isPercentage = number.textContent.includes('%');
        const isRating = number.classList.contains('rating-number');

        function updateNumber(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);

          // Easing function
          const easeOutQuart = 1 - Math.pow(1 - progress, 4);
          const currentValue = Math.floor(finalValue * easeOutQuart);

          if (isPercentage) {
            number.textContent = currentValue + '%';
          } else if (isRating) {
            number.textContent = currentValue;
          } else {
            number.textContent = currentValue.toLocaleString();
          }

          if (progress < 1) {
            requestAnimationFrame(updateNumber);
          }
        }

        if (finalValue > 0) {
          requestAnimationFrame(updateNumber);
        }
      });
    }

    // Add hover effect to stats cards
    document.querySelectorAll('.stats-card').forEach(card => {
      card.addEventListener('mouseenter', function() {
        // Add glow effect
        this.style.boxShadow = '0 25px 50px rgba(109, 93, 216, 0.3)';

        // Animate inner elements
        const icon = this.querySelector('.card-header i');
        if (icon) {
          icon.style.transform = 'scale(1.2) rotate(10deg)';
        }
      });

      card.addEventListener('mouseleave', function() {
        this.style.boxShadow = '';

        const icon = this.querySelector('.card-header i');
        if (icon) {
          icon.style.transform = '';
        }
      });

      // Add click animation
      card.addEventListener('click', function() {
        this.style.transform = 'translateY(-8px) scale(0.98)';
        setTimeout(() => {
          this.style.transform = 'translateY(-8px)';
        }, 150);
      });
    });

    // Chart interactions
    const ratingChart = document.getElementById('ratingChart');
    if (ratingChart) {
      const canvas = ratingChart.querySelector('canvas');
      if (canvas) {
        canvas.addEventListener('mousemove', function(e) {
          const rect = canvas.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          // Add tooltip or highlight effect here
          canvas.style.cursor = 'crosshair';
        });
      }
    }

    // History item interactions
    document.querySelectorAll('.history-item').forEach(item => {
      item.addEventListener('mouseenter', function() {
        this.style.backgroundColor = 'rgba(109, 93, 216, 0.08)';
        this.style.transform = 'translateX(10px)';
        this.style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.1)';
      });

      item.addEventListener('mouseleave', function() {
        this.style.backgroundColor = '';
        this.style.transform = '';
        this.style.boxShadow = '';
      });
    });

    // Add pulse animation to important elements
    const importantElements = document.querySelectorAll('.rating-change-value.positive, .rating-change-value.negative');
    importantElements.forEach(el => {
      el.style.animation = 'pulse 2s ease-in-out infinite';
    });

    // Add pulse animation CSS
    const style = document.createElement('style');
    style.textContent = `
      @keyframes pulse {
        0%, 100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .stats-card {
        cursor: pointer;
      }

      .stats-card .card-header i {
        transition: transform 0.3s ease;
      }

      .history-item {
        transition: all 0.3s ease;
      }

      canvas {
        transition: transform 0.3s ease;
      }

      canvas:hover {
        transform: scale(1.02);
      }
    `;
    document.head.appendChild(style);

    // Smooth scroll for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Initialize charts with better colors
    if (typeof Chart !== 'undefined') {
      Chart.defaults.color = '#e0e0e0';
      Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';

      // Configure default chart options
      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              color: '#e0e0e0',
              font: {
                family: 'Poppins'
              }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(26, 26, 46, 0.9)',
            titleColor: '#e0e0e0',
            bodyColor: '#a0a0a0',
            borderColor: '#40405f',
            borderWidth: 1
          }
        }
      };
    }

    // Add loading state to charts
    function addLoadingToChart(chartId) {
      const chartContainer = document.getElementById(chartId);
      if (chartContainer) {
        const canvas = chartContainer.querySelector('canvas');
        if (canvas) {
          // Add loading overlay
          const loadingOverlay = document.createElement('div');
          loadingOverlay.style.cssText = `
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 26, 46, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            z-index: 10;
          `;
          loadingOverlay.innerHTML = `
            <div style="text-align: center;">
              <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--primary-color);"></i>
              <p style="margin-top: 10px; color: var(--text-secondary);">로딩 중...</p>
            </div>
          `;
          chartContainer.appendChild(loadingOverlay);

          // Remove loading after 1 second (simulate data loading)
          setTimeout(() => {
            loadingOverlay.remove();
          }, 1000);
        }
      }
    }

    // Initialize loading states
    addLoadingToChart('ratingChart');
    addLoadingToChart('recordChart');
  </script>
</body>
</html>